<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Camera API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .camera-container { margin: 20px 0; }
        video, canvas { border: 1px solid #ccc; max-width: 100%; }
        button { padding: 10px 15px; margin: 5px; font-size: 16px; }
        .gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .gallery img { max-width: 200px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>üì∑ Camera API HTML5</h1>

    <div class="camera-container">
        <h3>C√°mara en Tiempo Real</h3>
        <video id="video" width="400" height="300" autoplay></video>
        <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>
        <br>
        <button onclick="startCamera()">üé• Iniciar C√°mara</button>
        <button onclick="takePhoto()">üì∏ Tomar Foto</button>
        <button onclick="stopCamera()">‚èπÔ∏è Detener C√°mara</button>
    </div>

    <div class="camera-container">
        <h3>Galer√≠a de Fotos</h3>
        <div class="gallery" id="gallery"></div>
    </div>

    <script>
        let stream;

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 400, height: 300 },
                    audio: false 
                });
                const video = document.getElementById('video');
                video.srcObject = stream;
            } catch (err) {
                console.error("Error al acceder a la c√°mara:", err);
                alert("No se pudo acceder a la c√°mara. Aseg√∫rate de permitir el acceso.");
            }
        }

        function takePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const dataUrl = canvas.toDataURL('image/png');
            addPhotoToGallery(dataUrl);
        }

        function addPhotoToGallery(dataUrl) {
            const gallery = document.getElementById('gallery');
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = 'Foto tomada';
            gallery.appendChild(img);
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                const video = document.getElementById('video');
                video.srcObject = null;
            }
        }

        // Filtros para im√°genes
        function applyFilter(filter) {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                switch(filter) {
                    case 'grayscale':
                        const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                        data[i] = data[i + 1] = data[i + 2] = gray;
                        break;
                    case 'sepia':
                        data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                        data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                        data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                        break;
                    case 'invert':
                        data[i] = 255 - r;
                        data[i + 1] = 255 - g;
                        data[i + 2] = 255 - b;
                        break;
                }
            }
            
            context.putImageData(imageData, 0, 0);
            addPhotoToGallery(canvas.toDataURL());
        }
    </script>
</body>
</html>